<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GoodPlates - Groceries & Nutrition Dashboard</title>
  <div id="global-header"></div>
<script>
  // change the filename depending on the page/user state
  const headerType = "header-2"; // "header-2" or "header-3"
  fetch(`/header/${headerType}.html`)
    .then(res => res.text())
    .then(html => document.querySelector("#global-header").innerHTML = html);
</script>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* ===== GoodPlates tokens (minimal replacements) ===== */
    :root{
      --bg: #ffffff;               /* page background */
      --fg: #0f172a;               /* primary text (black-ish) */
      --muted: #6b7280;            /* muted text */
      --muted-2: #9ca3af;          /* secondary muted */
      --border: #e5e7eb;           /* card border */
      --surface: #ffffff;          /* card surface */
      --surface-2: #f3f4f6;        /* subtle panel bg */
      --primary: #16a34a;          /* green-600 */
      --primary-700: #15803d;      /* green-700 */
      --primary-100: #dcfce7;      /* green-100 */
      --ring: rgba(16,185,129,.35);
      --shadow: 0 1px 2px rgba(0,0,0,.06), 0 8px 24px rgba(2,6,23,.06);
      --radius: 16px;

      /* kept names used by the existing CSS for minimal change */
      --accent: var(--primary);
      --accent-soft: rgba(22,163,74,0.08);
      --card: var(--surface);
    }

    /* Base */
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: var(--bg);
      color: var(--fg);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    /* minimal tweaks to match GoodPlates card styles while preserving layout */
    .card {
      background: var(--card);
      border-radius: 12px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    /* badges / active pill tuned to green tokens */
    .pro-badge{
      background: linear-gradient(90deg,var(--primary-100), #e6ffef);
      color:var(--primary);
      font-weight:600; padding:4px 8px; border-radius:999px; font-size:12px;
    }
    .active-pill{
      background: linear-gradient(90deg,var(--primary),var(--primary-700));
      color:white; padding:10px 18px; border-radius:999px;
    }

    .small-dot{ width:6px;height:6px;border-radius:99px;background:var(--surface-2); }
    .dot-active{ background:linear-gradient(90deg,var(--primary),#34d399); }

    .dots { width:8px;height:8px;border-radius:999px;background:#f3f4f6; }
    .shadow-soft{ box-shadow: 0 6px 20px rgba(16,24,40,0.06); }

    /* floating save button tuned to primary */
    .upgrade-btn{
      position:fixed; right:28px; bottom:28px;
      background: linear-gradient(90deg,var(--primary),var(--primary-700));
      color:white; padding:12px 20px; border-radius:999px;
      box-shadow:0 8px 30px rgba(22,163,74,0.18);
    }

    .chart-ghost { stroke:var(--primary-100); stroke-width:3; stroke-linecap:round; }

    /* override a few Tailwind utility colors used in markup so they match tokens (keeps utility classes) */
    .text-slate-700 { color: var(--fg) !important; }
    .text-slate-600 { color: var(--muted) !important; }
    .text-slate-500 { color: var(--muted) !important; }
    .text-slate-400 { color: var(--muted-2) !important; }
    .text-slate-800 { color: var(--fg) !important; }

    .bg-white { background: var(--surface) !important; }
    .bg-green-50 { background: var(--primary-100) !important; }
    .bg-slate-50 { background: var(--surface-2) !important; }

    .border-slate-100 { border-color: var(--border) !important; }
    .rounded-md { border-radius: 10px !important; }
  </style>
</head>
<body class="antialiased">
  <div class="flex min-h-screen">

    <!-- Main content -->
    <main class="flex-1 p-8">

      <!-- cards grid -->
      <div class="grid grid-cols-12 gap-6">
        <!-- Calorie Summary card (keeps exact style) -->
        <div class="col-span-4 card p-6">
          <div class="flex items-start justify-between">
            <div>
              <div class="text-slate-600 font-semibold">Calorie Summary</div>
              <div class="text-sm text-slate-400">Total kcal per 100g (sample)</div>
              <div id="bigKcal" class="mt-4 text-3xl font-bold text-slate-800">-- kcal</div>
              <div id="pctTarget" class="text-sm text-slate-500 mt-1">-- of daily target</div>
              <button id="viewRecipes" class="mt-4 px-4 py-2 rounded-md bg-gradient-to-r from-blue-600 to-indigo-500 text-white text-sm font-semibold">View Recipes</button>
            </div>
            <div class="ml-4 flex items-center">
              <!-- trophy svg kept as decorative -->
              <svg width="92" height="92" viewBox="0 0 92 92"><defs><linearGradient id="g" x1="0" x2="1"><stop offset="0" stop-color="#ffd27a"/><stop offset="1" stop-color="#ffb86b"/></linearGradient></defs><g fill="none" fill-rule="evenodd"><rect width="92" height="92" rx="12" fill="#fff"/><g transform="translate(10,10)"><path d="M35 8c-1 0-2 .9-2 2v9h-6c-3 0-6 3-6 6v7c0 3 3 6 6 6h4v6h22v-6h4c3 0 6-3 6-6v-7c0-3-3-6-6-6h-6V10c0-1.1-.9-2-2-2H35z" fill="url(#g)"/></g></g></svg>
            </div>
          </div>
        </div>

        <!-- Ingredients Overview (kept structure, changed content) -->
        <div class="col-span-8 card p-6">
          <div class="flex items-start justify-between">
            <div>
              <div class="font-semibold text-slate-700">Ingredients Overview</div>
              <div class="text-sm text-slate-400">Calories, categories and quick stats</div>
            </div>
            <div class="dots"></div>
          </div>

          <div class="mt-6 grid grid-cols-4 gap-4">
            <div class="p-3 rounded-lg bg-green-50 flex items-center gap-3">
              <div class="w-10 h-10 rounded-md bg-white shadow flex items-center justify-center">ü•á</div>
              <div>
                <div class="text-sm text-slate-400">Top Ingredient</div>
                <div id="topIngredient" class="font-semibold">‚Äî</div>
              </div>
            </div>
            <div class="p-3 rounded-lg bg-purple-50 flex items-center gap-3">
              <div class="w-10 h-10 rounded-md bg-white shadow flex items-center justify-center">üì¶</div>
              <div>
                <div class="text-sm text-slate-400">Distinct Items</div>
                <div id="distinctItems" class="font-semibold">‚Äî</div>
              </div>
            </div>
            <div class="p-3 rounded-lg bg-yellow-50 flex items-center gap-3">
              <div class="w-10 h-10 rounded-md bg-white shadow flex items-center justify-center">‚öñÔ∏è</div>
              <div>
                <div class="text-sm text-slate-400">Avg kcal / 100g</div>
                <div id="avgKcal" class="font-semibold">‚Äî</div>
              </div>
            </div>
            <div class="p-3 rounded-lg bg-blue-50 flex items-center gap-3">
              <div class="w-10 h-10 rounded-md bg-white shadow flex items-center justify-center">üí∏</div>
              <div>
                <div class="text-sm text-slate-400">Monthly Budget</div>
                <div id="budgetVal" class="font-semibold">‚Äî</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Calories Line (replace previous weekly SVG but keep card look) -->
        <div class="col-span-5 card p-6">
          <div class="flex items-start justify-between">
            <div class="font-semibold text-slate-700">Calories Line (ingredients)</div>
            <div class="dots"></div>
          </div>

          <div class="mt-6">
     <div style="height:300px;">
      <canvas id="lineChart" style="width:100%;height:100%;display:block;"></canvas>
     </div>


            <div class="mt-4 flex items-center justify-between">
              <div id="lineSummary" class="text-2xl font-bold">-- kcal</div>
              <div class="text-sm text-slate-400">Total kcal (sum of loaded items / 100g)</div>
            </div>
            <button id="detailBtn" class="mt-4 w-full py-2 rounded-md bg-gradient-to-r from-orange-600 to-yellow-500 text-white font-semibold">View Details</button>
          </div>
        </div>

        <!-- Grocery Spend (replaces Total Earning) -->
        <div class="col-span-4 card p-6">
          <div class="flex items-start justify-between">
            <div class="font-semibold text-slate-700">Grocery Spend</div>
            <div class="dots"></div>
          </div>

          <div class="mt-4">
            <div class="text-3xl font-bold" id="spentVal">‚Äî</div>
            <div class="text-sm text-slate-400 mt-2">Estimated spend this month</div>

            <div class="mt-6 space-y-4">
              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-md bg-gradient-to-r from-green-50 to-green-100 flex items-center justify-center">F</div>
                  <div>
                    <div class="font-medium">Fruits</div>
                    <div class="text-sm text-slate-400">Apples, Berries</div>
                  </div>
                </div>
                <div id="spendFruits" class="text-sm font-semibold">‚Äî</div>
              </div>

              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-md bg-gradient-to-r from-yellow-50 to-red-50 flex items-center justify-center">V</div>
                  <div>
                    <div class="font-medium">Veg</div>
                    <div class="text-sm text-slate-400">Broccoli, Potato</div>
                  </div>
                </div>
                <div id="spendVeg" class="text-sm font-semibold">‚Äî</div>
              </div>

              <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                  <div class="w-10 h-10 rounded-md bg-gradient-to-r from-gray-50 to-slate-50 flex items-center justify-center">P</div>
                  <div>
                    <div class="font-medium">Protein</div>
                    <div class="text-sm text-slate-400">Chicken, Fish</div>
                  </div>
                </div>
                <div id="spendProt" class="text-sm font-semibold">‚Äî</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Small stat cards (right column) ‚Äî calories focused -->
        <div class="col-span-3 card p-4">
          <div class="text-slate-600 font-semibold" id="totalMonthCalories">-- kcal</div>
          <div class="text-sm text-slate-400">Total calories (month estimate)</div>
          <div class="mt-4 h-16 flex items-center justify-center">
            <!-- mini sparkline (keeps green stroke) -->
            <svg viewBox="0 0 120 40" class="w-full h-full">
              <polyline points="0,30 20,24 40,28 60,20 80,24 100,18 120,16" fill="none" stroke="#16a34a" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>

        <div class="col-span-2 card p-4">
          <div class="flex items-center justify-between">
            <div class="text-slate-600 font-semibold">Avg / day</div>
            <div class="dots"></div>
          </div>
          <div id="avgPerDay" class="mt-4 text-2xl font-bold">-- kcal</div>
          <div class="text-sm text-green-500 mt-1">based on loaded ingredients</div>
        </div>

        <div class="col-span-2 card p-4">
          <div class="text-slate-600 font-semibold">Nutrition Score</div>
          <div id="nutriScore" class="text-2xl font-bold mt-2">--%</div>
          <div class="text-sm text-slate-400 mt-2">Protein vs total kcal</div>
        </div>

        <div class="col-span-2 card p-4">
          <div class="text-slate-600 font-semibold">Items Loaded</div>
          <div id="itemsLoaded" class="text-2xl font-bold mt-2">--</div>
          <div class="mt-3 text-sm text-slate-400">Distinct ingredients</div>
        </div>

        <!-- lower big card: Calories by Category (pie) - replaces Sales by Countries but keeps size) -->
        <div class="col-span-6 card p-6">
          <div class="font-semibold text-slate-700">Calories by Category</div>
          <div class="mt-4 text-sm text-slate-400">Distribution of calories (per 100g) across categories</div>
          <div class="mt-6 h-48 rounded-md flex items-center justify-center">
            <canvas id="pieChart" class="w-full h-full" ></canvas>
          </div>
        </div>

        <!-- Budget widgets (keeps layout, rename) -->
        <div class="col-span-3 card p-6">
          <div class="flex items-center justify-between">
            <div class="font-semibold text-slate-700">Monthly Budget</div>
            <a class="text-sm text-green-600">Manage</a>
          </div>
          <div class="mt-4 text-2xl font-bold" id="budgetMain">‚Äî</div>
          <div class="mt-6 h-28 bg-slate-50 rounded-md flex items-center justify-center text-slate-300">[spend breakdown]</div>
        </div>

        <div class="col-span-3 card p-6">
          <div class="flex items-center justify-between">
            <div class="font-semibold text-slate-700">Shopping List</div>
            <a class="text-sm text-green-600">View All</a>
          </div>
          <div class="mt-4 text-2xl font-bold" id="shoppingCount">‚Äî</div>
          <div class="mt-6 h-28 bg-slate-50 rounded-md flex items-center justify-center text-slate-300">[quick list]</div>
        </div>

      </div>
     
<!-- START MARK  -->
      
    <!-- end module script -->
    </script>

    <!-- Avatar dropdown script (moved out of module; safe standalone script) -->
    <script>
(function () {
  function $id(id) { return document.getElementById(id); }

  function ensurePortal(menu) {
    if (!menu) return;
    if (menu.parentElement !== document.body) document.body.appendChild(menu);
    menu.classList.add('gp-portal');
  }

  // NOTE: uses both menu.dataset.gpLockedWidth and btn.dataset.gpLockedWidth fallback
  function placeMenu(btn, menu) {
    if (!btn || !menu) return;
    ensurePortal(menu);

    menu.style.visibility = 'hidden';
    menu.hidden = false;
    menu.style.display = 'block';
    menu.style.position = 'fixed';
    menu.style.boxSizing = 'border-box';

    const prevTrans = menu.style.transition;
    menu.style.transition = 'none';

    // Try to reuse locked width from menu OR button (button persists across menu replacements)
    let locked = null;
    if (menu.dataset && menu.dataset.gpLockedWidth) {
      locked = parseInt(menu.dataset.gpLockedWidth, 10);
    } else if (btn.dataset && btn.dataset.gpLockedWidth) {
      locked = parseInt(btn.dataset.gpLockedWidth, 10);
    }

    if (!locked || Number.isNaN(locked)) {
      // Clear any inline width constraints for honest measurement
      menu.style.width = 'auto';
      menu.style.minWidth = '';
      menu.style.maxWidth = '';

      // Measure intrinsic content width (scrollWidth is reliable)
      const intrinsic = Math.ceil(menu.scrollWidth || 180);
      const maxW = Math.max(0, window.innerWidth - 16);
      locked = Math.min(intrinsic, maxW);

      // Persist to both menu and button so menu node swaps won't lose the value
      try {
        menu.dataset.gpLockedWidth = String(locked);
      } catch (e) { /* ignore if can't set */ }
      try {
        btn.dataset.gpLockedWidth = String(locked);
      } catch (e) { /* ignore if can't set */ }
    }

    // Apply locked width and reasonable height
    menu.style.width = locked + 'px';
    menu.style.minWidth = locked + 'px';
    menu.style.maxWidth = locked + 'px';
    menu.style.overflowY = 'auto';
    menu.style.maxHeight = (window.innerHeight - 32) + 'px';

    // Position: right-align to button, flip if needed
    const rect = btn.getBoundingClientRect();
    const gap = 8;
    const menuW = locked;
    let left = rect.right - menuW;
    let top = rect.bottom + gap;

    left = Math.max(8, Math.min(left, window.innerWidth - menuW - 8));

    const contentH = menu.scrollHeight || menu.offsetHeight || 0;
    if (top + contentH > window.innerHeight - 8) {
      top = Math.max(8, rect.top - contentH - gap);
    }

    menu.style.left = left + 'px';
    menu.style.top = top + 'px';

    requestAnimationFrame(function () {
      menu.style.transition = prevTrans || '';
      menu.style.visibility = 'visible';
    });
  }

  function openMenu(btn, menu) {
    placeMenu(btn, menu);
    menu.setAttribute('data-gp-open', 'true');
    if (btn) btn.setAttribute('aria-expanded', 'true');
    const firstItem = menu.querySelector('[role="menuitem"], a, button');
    if (firstItem) firstItem.focus();
    setTimeout(function () { placeMenu(btn, menu); }, 45);
  }

  function closeMenu(btn, menu) {
    if (!menu) return;
    menu.hidden = true;
    menu.style.visibility = 'hidden';
    menu.removeAttribute('data-gp-open');
    if (btn) btn.setAttribute('aria-expanded', 'false');
    // KEEP persisted gpLockedWidth on btn/menu to ensure stable reopen sizing
  }

  function onceAdd(el, ev, fn) {
    if (!el) return;
    if (!el._gp_listened) el._gp_listened = {};
    if (el._gp_listened[ev]) return;
    el.addEventListener(ev, fn);
    el._gp_listened[ev] = true;
  }

  function bindControls() {
    const btn = $id('avatarBtn');
    const menu = $id('avatarMenu');
    const btnMobile = $id('avatarBtnMobile');
    const menuMobile = $id('avatarMenuMobile');

    if (!btn && !btnMobile) return;

    if (btn && menu) {
      onceAdd(btn, 'click', function (e) {
        e.stopPropagation();
        if (e.stopImmediatePropagation) e.stopImmediatePropagation();
        const opened = menu.getAttribute('data-gp-open') === 'true';
        if (opened) closeMenu(btn, menu); else openMenu(btn, menu);
      });
    }

    if (btnMobile && menuMobile) {
      onceAdd(btnMobile, 'click', function (e) {
        e.stopPropagation();
        if (e.stopImmediatePropagation) e.stopImmediatePropagation();
        const opened = menuMobile.getAttribute('data-gp-open') === 'true';
        if (opened) closeMenu(btnMobile, menuMobile); else openMenu(btnMobile, menuMobile);
      });
    }

    onceAdd(document, 'click', function (e) {
      if (menu && menu.getAttribute('data-gp-open') === 'true') {
        if (!menu.contains(e.target) && !(btn && btn.contains(e.target))) closeMenu(btn, menu);
      }
      if (menuMobile && menuMobile.getAttribute('data-gp-open') === 'true') {
        if (!menuMobile.contains(e.target) && !(btnMobile && btnMobile.contains(e.target))) closeMenu(btnMobile, menuMobile);
      }
    });

    onceAdd(document, 'keydown', function (e) {
      if (e.key === 'Escape') {
        if (menu && menu.getAttribute('data-gp-open') === 'true') closeMenu(btn, menu);
        if (menuMobile && menuMobile.getAttribute('data-gp-open') === 'true') closeMenu(btnMobile, menuMobile);
      }
    });

    onceAdd(window, 'resize', function () {
      if (menu && menu.getAttribute('data-gp-open') === 'true') placeMenu(btn, menu);
      if (menuMobile && menuMobile.getAttribute('data-gp-open') === 'true') placeMenu(btnMobile, menuMobile);
    });
    onceAdd(window, 'scroll', function () {
      if (menu && menu.getAttribute('data-gp-open') === 'true') placeMenu(btn, menu);
      if (menuMobile && menuMobile.getAttribute('data-gp-open') === 'true') placeMenu(btnMobile, menuMobile);
    }, true);

    const top = document.querySelector('.gp-topnav');
    if (top) {
      top.style.pointerEvents = 'auto';
      Array.from(top.querySelectorAll('*')).forEach(el => el.style.pointerEvents = 'auto');
    }
  }

  function init() { bindControls(); }

  try { init(); } catch (e) { /* silent fail */ }

  const mo = new MutationObserver(function () {
    if ($id('avatarBtn') || $id('avatarBtnMobile')) init();
  });
  mo.observe(document.documentElement || document.body, { childList: true, subtree: true });

  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', init);
  else setTimeout(init, 0);
})();
</script>

<!-- END MARK  -->
      
    </main>
  </div>
    <script type="module" src="../dashboard/dashboard.js"></script>
  <div id="footer"></div>
<script>
  fetch("/footer/index.html")
    .then(res => res.text())
    .then(data => {
      document.getElementById("footer").innerHTML = data;
    });
</script>


<!-- ====== PASTE THIS AT THE BOTTOM OF YOUR DASHBOARD PAGE (before </body>) ====== -->
<script type="module">
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";


const auth = getAuth();
const db = getFirestore();

async function waitForAuthOnce() {
  return new Promise(resolve => {
    const unsub = onAuthStateChanged(auth, user => { unsub(); resolve(user); });
  });
}

async function showOnboardingModalIfNeeded() {
  const user = await waitForAuthOnce();
  if (!user || user.isAnonymous) {
    window.location.href = '/login-form/?next=/';
    return;
  }

  const uid = user.uid;
  const profileRef = doc(db, 'profiles', uid);
  const snap = await getDoc(profileRef);
  const already = snap.exists() && snap.data()?.onboardingComplete === true;
  if (already) return; // nothing to do

  if (!snap.exists()) {
    await setDoc(profileRef, { onboardingComplete: false, onboardingStartedAt: serverTimestamp() }, { merge: true });
  }

  // create overlay (container .onb-root will contain the pasted markup)
  const overlay = document.createElement('div');
  overlay.id = 'gp-onb-overlay';
  overlay.style = 'position:fixed;inset:0;z-index:99999;display:flex;align-items:center;justify-content:center;padding:24px;background:rgba(15,23,42,0.6);backdrop-filter: blur(4px);';

  const modalInner = `
    <div id="gp-onb-modal" style="width:min(1100px,96%);max-height:92vh;overflow:auto;border-radius:1rem;background:transparent;">


<style>
    /* visuals */
    .btn-gradient { color:#fff; background: linear-gradient(90deg,#17A34B,#12B981); }
    .soft-gradient { background: linear-gradient(135deg,#F3F4F6,#FFFFFF 40%,#F3F4F6); }
    .card { background:#fff; border:1px solid #E5E7EB; border-radius:1rem; box-shadow:0 1px 3px rgba(0,0,0,0.04); }
    .card-hover { transition: transform .12s, box-shadow .12s; }
    .card-hover:hover { transform: translateY(-2px); box-shadow:0 8px 24px rgba(0,0,0,0.06); }

    /* chips */
    .chip {
      display:inline-flex; align-items:center; gap:0.5rem; padding:0.5rem 1rem; border-radius:9999px;
      border:1px solid #E5E7EB; font-size:0.875rem; cursor:pointer; user-select:none; background:#fff; color:#111827;
      transition: transform .12s, box-shadow .12s, background-color .12s, color .12s;
      outline:none;
    }
    .chip:hover { transform: translateY(-3px) scale(1.02); box-shadow:0 6px 18px rgba(2,6,23,0.08); background:#21cc93; }
    .chip:focus { box-shadow:0 0 0 4px rgba(16,185,129,0.12); }
    .chip-selected { background:#12B981; color:#fff; border-color:transparent; box-shadow: inset 0 -2px 0 rgba(0,0,0,0.06); }

    /* allergies grid */
    #allergiesContainer { display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px; }
    @media (min-width:640px){ #allergiesContainer { grid-template-columns:repeat(3,minmax(0,1fr)); } }
    @media (min-width:768px){ #allergiesContainer { grid-template-columns:repeat(4,minmax(0,1fr)); } }

    /* Progress bar gradient animation */
    .progress-track { width:100%; height:0.5rem; background:#E5E7EB; border-radius:9999px; overflow:hidden; }
    .progress-fill {
      height:100%;
      width:0%;
      border-radius:9999px;
      /* animated gradient background */
      background: linear-gradient(90deg, rgba(23,163,75,0.95) 0%, rgba(18,185,129,0.95) 25%, rgba(16,185,129,0.95) 50%, rgba(18,185,129,0.95) 75%, rgba(23,163,75,0.95) 100%);
      background-size: 200% 100%;
      animation: moveGradient 3s linear infinite;
      transition: width 360ms cubic-bezier(.2,.9,.2,1);
    }
    @keyframes moveGradient {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }

    /* small helper disabled style */
    button:disabled { opacity:0.55; cursor:not-allowed; }
  </style>
<main class="soft-gradient min-h-screen">
    <div class="max-w-4xl mx-auto px-6 py-12">
      <!-- Header -->
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold mb-2">Welcome to GoodPlates</h1>
        <p class="text-gray-600">Let's personalize your experience in just 3 simple steps</p>
      </div>

      <!-- Progress -->
      <div class="mb-6">
        <div class="flex justify-between text-sm text-gray-500 mb-2">
          <span id="progressLabel">Step 1 of 3</span>
          <span id="progressPct">33% Complete</span>
        </div>
        <div class="progress-track mb-2">
          <!-- single progress fill element -->
          <div id="progressBar" class="progress-fill" style="width:33%"></div>
        </div>
      </div>

      <!-- Step Containers -->
      <section id="step-1" class="card p-8 mb-8">
        <h2 class="text-2xl font-semibold text-center mb-2">What do you want to do with groceries?</h2>
        <p class="text-gray-600 text-center mb-8">Choose one or more goals to help us customize your experience</p>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <button data-goal="grocery-list" class="card card-hover p-6 text-center group" aria-pressed="false" type="button">
            <div class="w-12 h-12 rounded-full bg-gray-200 grid place-items-center mx-auto mb-4 text-white text-xl">üõí</div>
            <h3 class="font-semibold mb-1">Make Grocery List</h3>
            <p class="text-sm text-gray-600">Create organized shopping lists</p>
          </button>

          <button data-goal="family-plan" class="card card-hover p-6 text-center group" aria-pressed="false" type="button">
            <div class="w-12 h-12 rounded-full bg-gray-200 grid place-items-center mx-auto mb-4 text-white text-xl">üë•</div>
            <h3 class="font-semibold mb-1">Grocery Family Plan</h3>
            <p class="text-sm text-gray-600">Plan meals for the whole family</p>
          </button>

          <button data-goal="in-app-order" class="card card-hover p-6 text-center group" aria-pressed="false" type="button">
            <div class="w-12 h-12 rounded-full bg-gray-200 grid place-items-center mx-auto mb-4 text-white text-xl">üì±</div>
            <h3 class="font-semibold mb-1">Order Using In-App Capabilities</h3>
            <p class="text-sm text-gray-600">Shop directly through the app</p>
          </button>

          <button data-goal="budget-track" class="card card-hover p-6 text-center group" aria-pressed="false" type="button">
            <div class="w-12 h-12 rounded-full bg-gray-200 grid place-items-center mx-auto mb-4 text-white text-xl">üíµ</div>
            <h3 class="font-semibold mb-1">Track Grocery Budget</h3>
            <p class="text-sm text-gray-600">Monitor spending and save money</p>
          </button>

          <button data-goal="calorie-goals" class="card card-hover p-6 text-center group" aria-pressed="false" type="button">
            <div class="w-12 h-12 rounded-full bg-gray-200 grid place-items-center mx-auto mb-4 text-white text-xl">üéØ</div>
            <h3 class="font-semibold mb-1">Set Calories Goals</h3>
            <p class="text-sm text-gray-600">Reach your nutrition targets</p>
          </button>

          <button data-goal="health-calc" class="card card-hover p-6 text-center group" aria-pressed="false" type="button">
            <div class="w-12 h-12 rounded-full bg-gray-200 grid place-items-center mx-auto mb-4 text-white text-xl">üìà</div>
            <h3 class="font-semibold mb-1">Calculate Health</h3>
            <p class="text-sm text-gray-600">Track nutrients and wellness</p>
          </button>
        </div>
      </section>

      <!-- Step 2 -->
      <section id="step-2" class="card p-8 mb-8 hidden">
        <h2 class="text-2xl font-semibold text-center mb-2">Nutrition & Preferences</h2>
        <p class="text-gray-600 text-center mb-6">Quick selects ‚Äî pick the items that apply</p>

        <div class="max-w-3xl mx-auto space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Food allergies (tap to select)</label>
            <div id="allergiesContainer" style="gap:12px;">
              <button class="chip" data-value="peanuts" type="button">Peanuts</button>
              <button class="chip" data-value="tree_nuts" type="button">Tree nuts</button>
              <button class="chip" data-value="dairy" type="button">Dairy / Milk</button>
              <button class="chip" data-value="eggs" type="button">Eggs</button>
              <button class="chip" data-value="shellfish" type="button">Shellfish</button>
              <button class="chip" data-value="fish" type="button">Fish</button>
              <button class="chip" data-value="soy" type="button">Soy</button>
              <button class="chip" data-value="wheat_gluten" type="button">Wheat / Gluten</button>
              <button class="chip" data-value="sesame" type="button">Sesame</button>
              <button class="chip" data-value="mustard" type="button">Mustard</button>
              <button class="chip" data-value="sulfites" type="button">Sulfites</button>
              <button class="chip" data-value="celery" type="button">Celery</button>
              <button class="chip" data-value="lupin" type="button">Lupin</button>
              <button class="chip" data-value="mollusks" type="button">Mollusks</button>
              <button class="chip" data-value="none" type="button">No allergies</button>
            </div>
            <p class="text-xs text-gray-500 mt-1">Tap chips to toggle. Selected chips will be saved to your profile.</p>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Diet</label>
            <select id="dietSelect" class="w-full h-12 rounded-xl border border-gray-200 bg-white pl-4 pr-10 text-gray-900">
              <option value="">Choose a diet...</option>
              <option value="none">None / No specific diet</option>
              <option value="vegetarian">Vegetarian</option>
              <option value="vegan">Vegan</option>
              <option value="pescatarian">Pescatarian</option>
              <option value="flexitarian">Flexitarian</option>
              <option value="keto">Keto / Low-carb</option>
              <option value="paleo">Paleo</option>
              <option value="mediterranean">Mediterranean</option>
              <option value="lowfat">Low-fat</option>
              <option value="whole30">Whole30</option>
              <option value="halal">Halal</option>
              <option value="kosher">Kosher</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Calorie target (pick a preset)</label>
            <select id="caloriesSelect" class="w-full h-12 rounded-xl border border-gray-200 bg-white pl-4 pr-10 text-gray-900">
              <option value="">Choose calorie target...</option>
              <option value="1200">1200 kcal ‚Äî Weight loss (low)</option>
              <option value="1400">1400 kcal ‚Äî Weight loss</option>
              <option value="1600">1600 kcal ‚Äî Light activity</option>
              <option value="1800">1800 kcal ‚Äî Moderate</option>
              <option value="2000">2000 kcal ‚Äî Average adult</option>
              <option value="2200">2200 kcal ‚Äî Active</option>
              <option value="2500">2500 kcal ‚Äî High activity</option>
              <option value="custom">Custom</option>
            </select>
            <p class="text-xs text-gray-500 mt-1">Set a calorie goal with our <a href="/calculator/" class="underline">Calorie Calculator</a>. Advanced users can set macros later in settings.</p>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">What currency do you usually buy groceries in?</label>
            <select id="currencySelect" class="w-full h-12 rounded-xl border border-gray-200 bg-white pl-4 pr-10 text-gray-900">
              <option value="">Choose currency...</option>
              <option value="USD">USD ‚Äî US Dollar</option>
              <option value="EUR">EUR ‚Äî Euro</option>
              <option value="GBP">GBP ‚Äî British Pound</option>
              <option value="CAD">CAD ‚Äî Canadian Dollar</option>
              <option value="AUD">AUD ‚Äî Australian Dollar</option>
              <option value="NZD">NZD ‚Äî New Zealand Dollar</option>
              <option value="JPY">JPY ‚Äî Japanese Yen</option>
              <option value="CNY">CNY ‚Äî Chinese Yuan</option>
              <option value="INR">INR ‚Äî Indian Rupee</option>
              <option value="SEK">SEK ‚Äî Swedish Krona</option>
              <option value="NOK">NOK ‚Äî Norwegian Krone</option>
              <option value="DKK">DKK ‚Äî Danish Krone</option>
              <option value="CHF">CHF ‚Äî Swiss Franc</option>
              <option value="BRL">BRL ‚Äî Brazilian Real</option>
              <option value="ZAR">ZAR ‚Äî South African Rand</option>
              <option value="MXN">MXN ‚Äî Mexican Peso</option>
              <option value="SGD">SGD ‚Äî Singapore Dollar</option>
              <option value="HKD">HKD ‚Äî Hong Kong Dollar</option>
              <option value="ILS">ILS ‚Äî Israeli Shekel</option>
              <option value="RUB">RUB ‚Äî Russian Ruble</option>
              <option value="other">Other...</option>
            </select>
          </div>
        </div>
      </section>

      <!-- Step 3 -->
      <section id="step-3" class="card p-8 mb-8 hidden">
        <h2 class="text-2xl font-semibold text-center mb-2">Select your country of residence</h2>
        <p class="text-gray-600 text-center mb-8">This helps us customize your experience with local stores and currency</p>

        <div class="max-w-md mx-auto">
          <div class="relative">
            <select id="countrySelect" class="w-full h-12 rounded-xl border border-gray-200 bg-white pl-4 pr-10 text-gray-900">
              <option value="">Choose your country...</option>
<option>Afghanistan</option>
<option>Albania</option>
<option>Algeria</option>
<option>Andorra</option>
<option>Angola</option>
<option>Antigua and Barbuda</option>
<option>Argentina</option>
<option>Armenia</option>
<option>Australia</option>
<option>Austria</option>
<option>Azerbaijan</option>
<option>Bahamas</option>
<option>Bahrain</option>
<option>Bangladesh</option>
<option>Barbados</option>
<option>Belarus</option>
<option>Belgium</option>
<option>Belize</option>
<option>Benin</option>
<option>Bhutan</option>
<option>Bolivia</option>
<option>Bosnia and Herzegovina</option>
<option>Botswana</option>
<option>Brazil</option>
<option>Brunei</option>
<option>Bulgaria</option>
<option>Burkina Faso</option>
<option>Burundi</option>
<option>Cabo Verde</option>
<option>Cambodia</option>
<option>Cameroon</option>
<option>Canada</option>
<option>Central African Republic</option>
<option>Chad</option>
<option>Chile</option>
<option>China</option>
<option>Colombia</option>
<option>Comoros</option>
<option>Congo (Congo-Brazzaville)</option>
<option>Costa Rica</option>
<option>Croatia</option>
<option>Cuba</option>
<option>Cyprus</option>
<option>Czechia (Czech Republic)</option>
<option>Democratic Republic of the Congo</option>
<option>Denmark</option>
<option>Djibouti</option>
<option>Dominica</option>
<option>Dominican Republic</option>
<option>Ecuador</option>
<option>Egypt</option>
<option>El Salvador</option>
<option>Equatorial Guinea</option>
<option>Eritrea</option>
<option>Estonia</option>
<option>Eswatini (fmr. "Swaziland")</option>
<option>Ethiopia</option>
<option>Fiji</option>
<option>Finland</option>
<option>France</option>
<option>Gabon</option>
<option>Gambia</option>
<option>Georgia</option>
<option>Germany</option>
<option>Ghana</option>
<option>Greece</option>
<option>Grenada</option>
<option>Guatemala</option>
<option>Guinea</option>
<option>Guinea-Bissau</option>
<option>Guyana</option>
<option>Haiti</option>
<option>Holy See</option>
<option>Honduras</option>
<option>Hungary</option>
<option>Iceland</option>
<option>India</option>
<option>Indonesia</option>
<option>Iran</option>
<option>Iraq</option>
<option>Ireland</option>
<option>Israel</option>
<option>Italy</option>
<option>Jamaica</option>
<option>Japan</option>
<option>Jordan</option>
<option>Kazakhstan</option>
<option>Kenya</option>
<option>Kiribati</option>
<option>Kuwait</option>
<option>Kyrgyzstan</option>
<option>Laos</option>
<option>Latvia</option>
<option>Lebanon</option>
<option>Lesotho</option>
<option>Liberia</option>
<option>Libya</option>
<option>Liechtenstein</option>
<option>Lithuania</option>
<option>Luxembourg</option>
<option>Madagascar</option>
<option>Malawi</option>
<option>Malaysia</option>
<option>Maldives</option>
<option>Mali</option>
<option>Malta</option>
<option>Marshall Islands</option>
<option>Mauritania</option>
<option>Mauritius</option>
<option>Mexico</option>
<option>Micronesia</option>
<option>Moldova</option>
<option>Monaco</option>
<option>Mongolia</option>
<option>Montenegro</option>
<option>Morocco</option>
<option>Mozambique</option>
<option>Myanmar (formerly Burma)</option>
<option>Namibia</option>
<option>Nauru</option>
<option>Nepal</option>
<option>Netherlands</option>
<option>New Zealand</option>
<option>Nicaragua</option>
<option>Niger</option>
<option>Nigeria</option>
<option>North Korea</option>
<option>North Macedonia</option>
<option>Norway</option>
<option>Oman</option>
<option>Pakistan</option>
<option>Palau</option>
<option>Palestine State</option>
<option>Panama</option>
<option>Papua New Guinea</option>
<option>Paraguay</option>
<option>Peru</option>
<option>Philippines</option>
<option>Poland</option>
<option>Portugal</option>
<option>Qatar</option>
<option>Romania</option>
<option>Russia</option>
<option>Rwanda</option>
<option>Saint Kitts and Nevis</option>
<option>Saint Lucia</option>
<option>Saint Vincent and the Grenadines</option>
<option>Samoa</option>
<option>San Marino</option>
<option>Sao Tome and Principe</option>
<option>Saudi Arabia</option>
<option>Senegal</option>
<option>Serbia</option>
<option>Seychelles</option>
<option>Sierra Leone</option>
<option>Singapore</option>
<option>Slovakia</option>
<option>Slovenia</option>
<option>Solomon Islands</option>
<option>Somalia</option>
<option>South Africa</option>
<option>South Korea</option>
<option>South Sudan</option>
<option>Spain</option>
<option>Sri Lanka</option>
<option>Sudan</option>
<option>Suriname</option>
<option>Sweden</option>
<option>Switzerland</option>
<option>Syria</option>
<option>Tajikistan</option>
<option>Tanzania</option>
<option>Thailand</option>
<option>Timor-Leste</option>
<option>Togo</option>
<option>Tonga</option>
<option>Trinidad and Tobago</option>
<option>Tunisia</option>
<option>Turkey</option>
<option>Turkmenistan</option>
<option>Tuvalu</option>
<option>Uganda</option>
<option>Ukraine</option>
<option>United Arab Emirates</option>
<option>United Kingdom</option>
<option>United States of America</option>
<option>Uruguay</option>
<option>Uzbekistan</option>
<option>Vanuatu</option>
<option>Venezuela</option>
<option>Vietnam</option>
<option>Yemen</option>
<option>Zambia</option>
<option>Zimbabwe</option>
              <option value="other">Other...</option>
            </select>
            <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-gray-400">‚ñæ</span>
          </div>
        </div>
      </section>

      <!-- Navigation -->
      <div class="flex justify-between items-center">
        <button id="backBtn" class="px-5 h-11 rounded-xl border border-gray-300 bg-white text-gray-800 hover:bg-gray-50" type="button">Back</button>

        <div class="flex gap-2" aria-hidden="true">
          <div id="dot1" class="w-3 h-3 rounded-full" style="background:#12B981;"></div>
          <div id="dot2" class="w-3 h-3 rounded-full bg-gray-200"></div>
          <div id="dot3" class="w-3 h-3 rounded-full bg-gray-200"></div>
        </div>

        <button id="nextBtn" class="px-6 h-11 rounded-xl btn-gradient" type="button">Next</button>
        <a id="finishLink" href="#" class="hidden">
          <button id="finishBtn" class="px-6 h-11 rounded-xl btn-gradient" type="button">Finish</button>
        </a>
      </div>
    </div>
  </main>

    </div>
  `;

  overlay.innerHTML = modalInner;
  document.body.appendChild(overlay);

  // container scope: find elements inside the injected markup using container.querySelector
  const container = overlay.querySelector('#gp-onb-modal');
  if (!container) return console.error('Onboarding container missing.');

  // ---- IMPORTANT: your pasted HTML should include elements with these IDs (or similar).
  // We'll look them up inside the container (so duplicate global IDs elsewhere won't collide).
  const get = sel => container.querySelector(sel);

  // IDs we expect from your onboarding markup (if your markup differs, adjust selectors here)
  const stepEls = {
    1: get('#step-1'),
    2: get('#step-2'),
    3: get('#step-3')
  };
  const backBtn = get('#backBtn');
  const nextBtn = get('#nextBtn');
  const finishBtn = get('#finishBtn') || get('#finishLink button');
  const finishLink = get('#finishLink');
  const progressBar = get('#progressBar');
  const progressLabel = get('#progressLabel');
  const progressPct = get('#progressPct');
  const dots = [ get('#dot1'), get('#dot2'), get('#dot3') ];

  const goalsGrid = get('[data-goal]') ? container : get('#step-1'); // fallback
  const allergiesContainer = get('#allergiesContainer');
  const dietSelect = get('#dietSelect');
  const caloriesSelect = get('#caloriesSelect');
  const currencySelect = get('#currencySelect');
  const countrySelect = get('#countrySelect');

  // create a small status area if not present
  let statusEl = get('#onboardingStatus');
  if (!statusEl) {
    statusEl = document.createElement('div');
    statusEl.id = 'onboardingStatus';
    statusEl.style.marginTop = '8px';
    statusEl.style.color = '#065f46';
    container.appendChild(statusEl);
  }

  // state
  let currentStep = 1;
  let selectedGoals = [];
  let selectedAllergies = [];
  let selectedDiet = "";
  let selectedCalories = "";
  let selectedCurrency = "";
  let selectedCountry = "";
  const steps = [1,2,3];

  function updateProgress() {
    const total = steps.length;
    const pct = Math.round((currentStep / total) * 100);
    if (progressBar) progressBar.style.width = pct + '%';
    if (progressLabel) progressLabel.textContent = `Step ${currentStep} of ${total}`;
    if (progressPct) progressPct.textContent = `${pct}% Complete`;
    dots.forEach((d,i) => { if (d) d.style.background = (i < currentStep) ? '#12B981' : '#E5E7EB'; });
  }

  function showStep(step) {
    steps.forEach(s => { if (stepEls[s]) stepEls[s].classList.toggle('hidden', s !== step); });
    if (backBtn) backBtn.disabled = step === 1;
    const can = canProceed();
    if (step < 3) {
      if (nextBtn) nextBtn.classList.remove('hidden'), (nextBtn.disabled = !can);
      if (finishLink) finishLink.classList.add('hidden');
    } else {
      if (nextBtn) nextBtn.classList.add('hidden');
      if (finishLink) finishLink.classList.remove('hidden'), (finishBtn.disabled = !can);
    }
    updateProgress();
  }

  function canProceed() {
    if (currentStep === 1) return selectedGoals.length > 0;
    if (currentStep === 2) return selectedDiet !== "" && selectedCalories !== "" && selectedCurrency !== "";
    if (currentStep === 3) return selectedCountry !== "";
    return false;
  }

  // Step 1 toggles (select cards with data-goal). Look inside container for elements that have data-goal attribute.
  container.querySelectorAll('[data-goal]').forEach(card => {
    card.addEventListener('click', () => {
      const g = card.dataset.goal;
      const i = selectedGoals.indexOf(g);
      if (i === -1) {
        selectedGoals.push(g);
        card.setAttribute('data-selected','true');
        card.classList.add('ring-2','ring-green-600','bg-green-50');
        card.setAttribute('aria-pressed','true');
      } else {
        selectedGoals.splice(i,1);
        card.removeAttribute('data-selected');
        card.classList.remove('ring-2','ring-green-600','bg-green-50');
        card.setAttribute('aria-pressed','false');
      }
      if (nextBtn) nextBtn.disabled = !canProceed();
    });
  });

  // allergies chips
  if (allergiesContainer) {
    allergiesContainer.querySelectorAll('button[data-value]').forEach(btn => {
      btn.addEventListener('click', () => {
        const val = btn.dataset.value;
        if (val === 'none') {
          selectedAllergies = ['none'];
          allergiesContainer.querySelectorAll('button').forEach(b => b.classList.toggle('chip-selected', b.dataset.value === 'none'));
        } else {
          const i = selectedAllergies.indexOf(val);
          if (i === -1) {
            const noneIdx = selectedAllergies.indexOf('none');
            if (noneIdx !== -1) selectedAllergies.splice(noneIdx,1);
            selectedAllergies.push(val);
            btn.classList.add('chip-selected');
          } else {
            selectedAllergies.splice(i,1);
            btn.classList.remove('chip-selected');
          }
          allergiesContainer.querySelectorAll('button[data-value="none"]').forEach(b => {
            b.classList.toggle('chip-selected', selectedAllergies.length === 1 && selectedAllergies[0] === 'none');
          });
        }
      });
    });
  }

  // selects wiring
  if (dietSelect) dietSelect.addEventListener('change', e => { selectedDiet = e.target.value; updateNextFinishState(); });
  if (caloriesSelect) caloriesSelect.addEventListener('change', e => { selectedCalories = e.target.value; updateNextFinishState(); });
  if (currencySelect) currencySelect.addEventListener('change', e => { selectedCurrency = e.target.value; updateNextFinishState(); });
  if (countrySelect) countrySelect.addEventListener('change', e => { selectedCountry = e.target.value; updateNextFinishState(); });

  function updateNextFinishState(){ if (nextBtn) nextBtn.disabled = !canProceed(); if (finishBtn) finishBtn.disabled = !canProceed(); }

  // navigation wiring (back/next)
  if (backBtn) backBtn.addEventListener('click', () => { currentStep = Math.max(1, currentStep - 1); showStep(currentStep); });
  if (nextBtn) nextBtn.addEventListener('click', () => { if (!canProceed()) return; currentStep = Math.min(3, currentStep + 1); showStep(currentStep); });

  // optional close button inside your pasted markup (if present). If you want non-dismissable, remove your close from markup.
  const closeBtn = container.querySelector('#gp-onb-close');
  if (closeBtn) closeBtn.addEventListener('click', () => { overlay.remove(); });

  // save function (writes onboardingComplete:true)
  async function saveProfileAndClose() {
    if (!finishBtn) return;
    finishBtn.disabled = true;
    const prev = finishBtn.textContent;
    finishBtn.textContent = 'Saving...';
    statusEl.style.color = '#065f46';
    statusEl.textContent = '';

    try {
      const userNow = auth.currentUser;
      if (!userNow || userNow.isAnonymous) { window.location.href = '/login-form/?next=/'; return; }
      const uidNow = uid || userNow.uid;
      const profileRefNow = doc(db, 'profiles', uidNow);
      const userRefNow = doc(db, 'users', uidNow);

      const caloriesNumber = selectedCalories && selectedCalories !== 'custom' ? parseInt(selectedCalories, 10) : null;
      const profilePatch = {
        nutritionInfo: { allergies: selectedAllergies.filter(Boolean), dietaryType: selectedDiet || '' },
        nutritionGoals: { calories: caloriesNumber },
        defaultCurrency: selectedCurrency || '',
        dietTags: selectedGoals || [],
        location: selectedCountry || '',
        onboardingComplete: true,
        onboardingCompletedAt: serverTimestamp(),
        updatedAt: serverTimestamp()
      };

      const existing = await getDoc(profileRefNow);
      if (existing.exists()) await updateDoc(profileRefNow, profilePatch);
      else await setDoc(profileRefNow, { ...profilePatch, createdAt: serverTimestamp() }, { merge: true });

      const userPatch = {};
      if (selectedGoals.length) userPatch.dietTags = selectedGoals;
      if (selectedCountry) userPatch.location = selectedCountry;
      if (Object.keys(userPatch).length) await setDoc(userRefNow, userPatch, { merge: true });

      statusEl.style.color = '#065f46';
      statusEl.textContent = 'Saved ‚Äî closing...';
      finishBtn.textContent = 'Saved';

      setTimeout(() => {
        const o = document.getElementById('gp-onb-overlay');
        if (o) o.remove();
        window.location.reload();
      }, 350);

    } catch (err) {
      console.error('Save failed', err);
      statusEl.style.color = '#b91c1c';
      statusEl.textContent = 'Failed to save ‚Äî try again';
      finishBtn.disabled = false;
      finishBtn.textContent = prev;
    }
  }

  // wire finish (container-scoped)
  if (finishBtn) finishBtn.addEventListener('click', (e) => { if (!canProceed()) { e.preventDefault(); return; } saveProfileAndClose(); });

  // show first step
  showStep(currentStep);

  // (optional) prefill logic from profile snapshot if you want to pre-check cards -- left minimal for now
}

showOnboardingModalIfNeeded().catch(e => { console.error('onboarding modal error', e); });
</script>
<!-- ====== END PASTE ====== -->


</body>
</html>

